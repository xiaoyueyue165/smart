## 目录

- 尽可能全面正确的解析一个任意 url
- `Event loop` 宏任务，微任务,打印结果？
- 对象深拷贝
- 数组排序
- 数组去重
- 数组扁平化
- bind 方法
- apply，call 方法
- 函数节流防抖
- 发布订阅模式 Event

## 内容

### 尽可能全面正确的解析一个任意 url

```js
var url =
  'http://www.domain.com/?user=anonymous&id=123&id=456&city=%E5%8C%97%E4%BA%AC&d&enabled';
// parseParam(url);
/**
结果：
{
   user: 'anonymous',
   id: [123, 456], // 重复出现的 key 要组装成数组，能被转成数字的就转成数字类型
   city: '北京', // 中文
   enabled: true, // 未指定值的 key 约定值为 true
}
*/

function parseParam(url) {
  var paramArr = decodeURI(url)
      .split('?')[1]
      .split('&'),
    obj = {};
  for (var i = 0; i < paramArr.length; i++) {
    var item = paramArr[i];
    if (item.indexOf('=') != -1) {
      var tmp = item.split('=');
      obj[tmp[0]] = tmp[1];
    } else {
      obj[item] = true;
    }
  }
  return obj;
}
var obj = parseParam(url);
console.log(obj);
```

### `Event loop` 宏任务，微任务,打印结果？

```js
new Promise(resolve => {
  console.log(1);
  setTimeout(() => {
    console.log(2);
  }, 0);
  Promise.resolve().then(() => {
    console.log(3);
  });
  resolve();
}).then(() => {
  console.log(4);
});
console.log(5);
```

// log: 1,5,3,4,2

### 对象深拷贝

```js
function deepCopy(obj) {
  if (typeof obj !== 'object') return;
  var newObj = obj instanceof Array ? [] : {};
  for (var key in obj) {
    if (obj.hasOwnProperty(key)) {
      newObj[key] =
        typeof obj[key] === 'object' ? deepCopy(obj[key]) : obj[key];
    }
  }
  return newObj;
}
```

### 数组排序

```js
function bubble(arr) {
  if (!Array.isArray(arr)) {
    throw new Error('arr 参数必须为数组类型');
  }
  for (var i = 0; i < arr.length; i++) {
    for (var j = 0; j < arr.length - i - 1; j++) {
      if (arr[j] > arr[j + 1]) {
        // 交换
        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
      }
    }
  }
  return arr;
}
console.log(bubble([3, 2, 1, 4, 8, 6, 7]));
```

### 数组去重

```js
function unique(arr) {
  return Array.from(new Set(arr));
}
function unique2(arr) {
  return arr.filter(function(item, index, arr) {
    //当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素
    return arr.indexOf(item, 0) === index;
  });
}
```

### 数组扁平化

```js
let givenArr = [
  [1, 2, 2],
  [3, 4, 5, 5],
  [6, 7, 8, 9, [11, 12, [12, 13, [14]]]],
  10,
];
let outputArr = [1, 2, 2, 3, 4, 5, 5, 6, 7, 8, 9, 11, 12, 12, 13, 14, 10];

// 实现flatten方法使得
function flatten(arr) {
  let res = [];
  for (let i = 0; i < arr.length; i++) {
    const item = arr[i];
    if (Array.isArray(item)) {
      res = res.concat(flatten(item));
    } else {
      res.push(item);
    }
  }
  return res;
}
console.log(flatten(givenArr));
```

### 函数节流防抖

```js
// html
<button>点击</button>;
// 函数防抖
document.querySelector('button').onclick = debounce(function() {
  console.log('click');
});
// 函数节流
document.querySelector('button').onclick = throttle(function() {
  console.log('click');
});

function debounce(fn, wait = 1000) {
  let timer;
  return function() {
    let context = this;
    let args = arguments;
    if (timer) {
      clearTimeout(timer);
    }
    timer = setTimeout(() => {
      fn.apply(context, args);
    }, wait);
  };
}

function throttle(fn, wait = 1500) {
  let _lastTime;
  return function() {
    let _nowTime = +new Date();
    if (_nowTime - _lastTime > wait || !_lastTime) {
      fn.apply(this, arguments);
      _lastTime = _nowTime;
    }
  };
}
```

### bind 方法

```js
Function.prototype.bind =
  Function.prototype.bind ||
  function(context) {
    var me = this;
    var args = Array.prototype.slice.call(arguments, 1);
    return function() {
      var innerArgs = Array.prototype.slice.call(arguments);
      var finalArgs = args.concat(innerArgs);
      return me.apply(context, finalArgs);
    };
  };
```

### 发布订阅模式 Event

```js
class Event {
  constructor() {
    this._cache = {};
  }
  // 绑定
  on(type, callback) {
    let fns = (this._cache[type] = this._cache[type] || []);
    if (fns.indexOf(callback) === -1) {
      fns.push(callback);
    }
    return this;
  }
  // 触发
  trigger(type, data) {
    let fns = this._cache[type];
    if (Array.isArray(fns)) {
      fns.forEach(fn => {
        fn(data);
      });
    }
    return this;
  }
  // 解绑
  off(type, callback) {
    let fns = this._cache[type];
    if (Array.isArray(fns)) {
      if (callback) {
        let index = fns.indexOf(callback);
        if (index !== -1) {
          fns.splice(index, 1);
        }
      } else {
        //全部清空
        fns.length = 0;
      }
    }
    return this;
  }
}
// 测试用例
const event = new Event();
event.on('test', a => {
  console.log(a);
});
event.trigger('test', 'hello world');

event.off('test');
event.trigger('test', 'hello world');
```
