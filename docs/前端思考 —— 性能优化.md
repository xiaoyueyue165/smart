## 前言

可以落地的才是好的方案~

## 目录

- [安全](#安全)
- [网络](#网络)
- [工程](#工程)
- [用户体验](#用户体验)
- [SEO](#SEO)

## 安全

不安全还提什么优化？

### XSS

> **跨网站指令码**（英语：Cross-site scripting，通常简称为：XSS）

**如何攻击**

XSS 攻击是指，通过执行恶意脚本，以实现窃取用户登陆态、劫持会话等目的的攻击方式。恶意脚本的输入源有，Cookies、Post 表单、Get 请求、HTTP 头内容等。通常，我们将一段 XSS 攻击的代码片段称之为 XSS 向量。

**如何防御**

1. 关键 Cookie 设置 HttpOnly：只能服务器端修改
2. 输入,输出检查：不要相信用户的任何输入
3. CSP 网站内容安全白名单过滤

**`cookie`不可被获取**：

![Snipaste_2020-01-11_01-11-38.png](http://ww1.sinaimg.cn/large/df551ea5ly1garyurgwknj20u80k73zt.jpg)

![Snipaste_2020-01-11_01-11-55.png](http://ww1.sinaimg.cn/large/df551ea5ly1garyvrqg48j20u8050jrl.jpg)

**输入输出的内容，对于引号，尖括号，斜杠进行转义：**

```js
function escape(str) {
  str = str.replace(/&/g, '&amp;');
  str = str.replace(/</g, '&lt;');
  str = str.replace(/>/g, '&gt;');
  str = str.replace(/"/g, '&quto;');
  str = str.replace(/'/g, '&#39;');
  str = str.replace(/`/g, '&#96;');
  str = str.replace(/\//g, '&#x2F;');
  return str;
}
```

通过转义可以将攻击代码 `<script>alert(1)</script>` 变成

```js
// escape('<script>alert(1)</script>');
&lt;script&gt;alert(1)&lt;&#x2F;script&gt;
```

对于显示富文本来说，不能通过上面的办法来转义所有字符，因为这样会把需要的格式也过滤掉。这种情况通常采用白名单过滤的办法，当然也可以通过黑名单过滤，但是考虑到需要过滤的标签和标签属性实在太多，更加推荐使用白名单的方式(如 [sanitize-html](https://github.com/apostrophecms/sanitize-html/))。

```js
var xss = require('xss');
var html = xss('<h1 id="title">XSS Demo</h1><script>alert("xss");</script>');
// -> <h1>XSS Demo</h1>&lt;script&gt;alert("xss");&lt;/script&gt;
console.log(html);
```

以上示例使用了 [js-xss](https://github.com/leizongmin/js-xss) 来实现。可以看到在输出中保留了 `h1` 标签且过滤了 `script` 标签

**CSP 通过白名单控制，仅允许加载指定的资源:**

通常可以通过 HTTP Header 中的 `Content-Security-Policy` 来开启 CSP

- 只允许加载本站资源

```http
Content-Security-Policy: default-src ‘self’
```

- 只允许加载 HTTPS 协议图片

```http
Content-Security-Policy: img-src https://*
```

- 允许加载任何来源框架

```http
Content-Security-Policy: child-src 'none'
```

更多属性可以查看 [这里](https://content-security-policy.com/)

### CSRF

> **跨站请求伪造**（英语：Cross-site request forgery）

1. get 不修改数据
2. 不被第三方网站访问到用户的 cookie
3. Referer（该 HTTP 请求的来源地址）检查，阻止第三方网站请求接口
4. 请求时附带验证信息，比如验证码或者 token

⬆ [返回顶部](#目录)

## 网络

两个思路方向：降低网络请求数量与加快网络速率

**减少网络请求数量：**

精灵图，HTTP Cache

**加快网络速率：**

CDN，DNS 预解析，gzip

### HTTP Cache

注意：只有 get 类型的资源可以被 http 缓存。

我们可以使用强缓存加协商缓存共同处理。配置合适的 `Cache-Control` `max-age`时间，这样在这段时间内浏览器可以复用本地缓存的资源。

需要后端同学配合实现~

![Snipaste_2020-01-10_23-48-59.png](http://ww1.sinaimg.cn/large/df551ea5ly1garwnzgu0ej20s90srmzz.jpg)

![](https://github-imglib-1255459943.cos.ap-chengdu.myqcloud.com/015353_P04w_568818.png)

⬆ [返回顶部](#目录)

## 工程

- webpack 打包优化，减小体积
- 非主路由考虑按需加载
- UI 库，utils 工具采用按需加载

⬆ [返回顶部](#目录)

## 用户体验

- **及时反馈原则**：

比如有一个点赞的功能，用户点击后我们应当首先给予反馈，点赞数加一，然后再去发送请求通知服务器；请求成功则业务结束，如果遇到请求出错的情况前端再将点赞数还原，同时`提示用户请求出错`。

- 防抖节流，动画，懒加载，404，数据统计

⬆ [返回顶部](#目录)

## SEO

- 首页 关键 meta

```html
<meta
  name="description"
  content="彩云科技致力于研究和应用人工智能技术服务大众。旗下有针对终端用户的app和面向开发者的开放平台。彩云小译－边说边译的同声传译，彩云天气－预报几点几分下雨和15天雾霾趋势。"
/>
<meta
  name="keywords"
  content="人工智能,翻译,同声传译,精准短时预报,气象雷达,分钟级数据更新,精准定位,空气质量,雾霾地图,天气预报API,预报API,分钟级,街道级,精细化,
  精准预报,天气预报,深度学习,机器学习,云图,污染,温度,生活,日历,雨时,下雨,户外,运动,旅行,助手,万年历,PM2.5,台风,冰雹,灾害,实时"
/>
<title>彩云科技 - 人工智能让生活更美好</title>
```

- SSR
- 骨架屏

⬆ [返回顶部](#目录)

#### 参考链接

- [知乎 - 浅谈 Js 操作 Cookie，以及 HttpOnly 的限制](https://zhuanlan.zhihu.com/p/36197012)
